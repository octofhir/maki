# Task 60: Documentation Website Improvements

**Phase**: 6 (Documentation - Weeks 22-23)
**Time Estimate**: 3-4 days
**Status**: üìù Planned
**Priority**: Medium
**Dependencies**: None (Astro site and maki-devtools already exist)

## Overview

Improve and complete the existing Astro documentation website (`docs/`) with comprehensive guides, API documentation, and automated content generation using maki-devtools.

**Current Status:**
- ‚úÖ Astro + Starlight setup exists
- ‚úÖ maki-devtools generates rule docs, schemas, configs
- üî® Need to complete content and automate updates

## Goals

1. **Complete user guides** - Installation, getting started, CLI reference
2. **Auto-generate rule docs** - Use maki-devtools to keep rule docs up-to-date
3. **Add examples** - Real-world FSH examples with explanations
4. **API documentation** - Document configuration options
5. **CI/CD integration** - Auto-deploy docs to GitHub Pages
6. **Search optimization** - Improve search and navigation

## Existing Infrastructure

### Astro Site Structure

```
docs/
‚îú‚îÄ‚îÄ astro.config.mjs           # Starlight configuration
‚îú‚îÄ‚îÄ package.json               # Scripts for doc generation
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ content/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ docs/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ index.mdx      # Home page
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ cli/           # CLI command docs
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ configuration/ # Config file docs
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ getting-started/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ guides/        # How-to guides
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ reference/     # API reference
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ rules/         # AUTO-GENERATED by maki-devtools
‚îÇ   ‚îî‚îÄ‚îÄ components/            # Astro components
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ schema/
‚îÇ       ‚îî‚îÄ‚îÄ v1.json           # AUTO-GENERATED JSON Schema
‚îî‚îÄ‚îÄ examples/
    ‚îî‚îÄ‚îÄ config.json           # AUTO-GENERATED config example
```

### maki-devtools Commands

Already implemented in `crates/maki-devtools/`:

```bash
# Generate all documentation
cargo run --bin maki-devtools -- generate-all -o docs

# Or individual commands:
cargo run --bin maki-devtools -- generate-schema -o docs/public/schema/v1.json
cargo run --bin maki-devtools -- generate-config -o docs/examples/config.json
cargo run --bin maki-devtools -- generate-rule-docs -o docs/src/content/docs/rules
```

## Tasks to Complete

### 1. Content Completion

**Missing documentation pages:**

- [ ] `docs/src/content/docs/installation.mdx` - Installation guide
- [ ] `docs/src/content/docs/getting-started/first-project.mdx` - Tutorial
- [ ] `docs/src/content/docs/getting-started/building.mdx` - Build process
- [ ] `docs/src/content/docs/cli/build.mdx` - `maki build` reference
- [ ] `docs/src/content/docs/cli/lint.mdx` - `maki lint` reference
- [ ] `docs/src/content/docs/cli/format.mdx` - `maki format` reference
- [ ] `docs/src/content/docs/cli/test.mdx` - `maki test` reference
- [ ] `docs/src/content/docs/configuration/sushi-config.mdx` - SUSHI compatibility
- [ ] `docs/src/content/docs/guides/migration.mdx` - Migrating from SUSHI
- [ ] `docs/src/content/docs/guides/lsp-setup.mdx` - IDE setup
- [ ] `docs/src/content/docs/reference/api.mdx` - Rust API docs

### 2. Enhance maki-devtools

Add more generators:

```rust
// In crates/maki-devtools/src/

// Add CLI reference generator
mod cli_doc_generator;

impl CliDocGenerator {
    pub fn generate(&self) -> Result<()> {
        // Generate markdown for each CLI command
        // Include usage, options, examples
    }
}

// Add example generator
mod example_generator;

impl ExampleGenerator {
    pub fn generate(&self) -> Result<()> {
        // Create example FSH files
        // Include common patterns
    }
}
```

### 3. GitHub Actions Workflow

```yaml
# .github/workflows/docs.yml
name: Deploy Documentation

on:
  push:
    branches: [main]
    paths:
      - 'docs/**'
      - 'crates/maki-rules/**'  # Re-generate on rule changes
      - '.github/workflows/docs.yml'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Rust
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable

      - name: Generate documentation artifacts
        run: |
          cargo run --bin maki-devtools -- generate-all -o docs

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8

      - name: Install dependencies
        run: cd docs && pnpm install

      - name: Build docs
        run: cd docs && pnpm run build

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs/dist
```

### 4. Improve Rule Documentation

Enhance `crates/maki-devtools/src/rule_doc_generator.rs`:

```rust
// Generate better rule docs with:
// - Examples of violations
// - Examples of fixes
// - Configuration options
// - Related rules

pub fn generate_rule_doc(rule: &dyn Rule) -> String {
    format!(r#"---
title: {name}
description: {description}
category: {category}
severity: {severity}
autofix: {has_autofix}
---

# {name}

{description}

## Examples

### ‚ùå Incorrect

```fsh
{bad_example}
```

### ‚úÖ Correct

```fsh
{good_example}
```

## Configuration

```json
{{
  "rules": {{
    "{rule_id}": "error"  // or "warn", "off"
  }}
}}
```

## Autofix

{autofix_description}

## Related Rules

{related_rules}
"#)
}
```

### 5. Add Interactive Examples

Use Astro components for interactive examples:

```astro
---
// docs/src/components/FshExample.astro
export interface Props {
  code: string;
  title?: string;
}

const { code, title } = Astro.props;
---

<div class="fsh-example">
  {title && <h4>{title}</h4>}
  <pre><code class="language-fsh">{code}</code></pre>
</div>

<style>
  .fsh-example {
    border: 1px solid var(--sl-color-gray-5);
    border-radius: 8px;
    padding: 1rem;
    margin: 1rem 0;
  }
</style>
```

## Package.json Scripts

Already exist, but document them:

```json
{
  "scripts": {
    "dev": "astro dev",                    // Start dev server
    "build": "astro check && astro build", // Build for production
    "build:full": "pnpm run generate-all && astro check && astro build",
    "preview": "astro preview",            // Preview built site
    "generate-all": "cd .. && cargo run --bin maki-devtools -- generate-all -o docs"
  }
}
```

## Documentation URL

Deploy to: `https://octofhir.github.io/maki/`

## Acceptance Criteria

- [ ] All core documentation pages written
- [ ] maki-devtools auto-generates rule docs
- [ ] GitHub Actions deploys docs automatically
- [ ] Search works well
- [ ] Mobile-friendly design
- [ ] Dark mode works
- [ ] Code examples are syntax-highlighted
- [ ] Navigation is clear and intuitive
- [ ] Rule documentation includes examples and autofixes
- [ ] CLI reference is complete
- [ ] Migration guide from SUSHI exists

## Implementation Steps

1. **Complete content** (2 days)
   - Write missing guides
   - Add examples
   - Create tutorials

2. **Enhance generators** (1 day)
   - Improve rule doc generator
   - Add CLI doc generator
   - Better examples

3. **Setup CI/CD** (0.5 days)
   - GitHub Actions workflow
   - Automated deployment

4. **Polish** (0.5 days)
   - Fix navigation
   - Improve search
   - Test mobile

---

**Status**: Ready for implementation (infrastructure exists, need content)
**Estimated Complexity**: Medium (writing + automation)
**Priority**: Medium (needed for user adoption)
**Updated**: 2025-11-03
